<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Detalle de Visita</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body>
<div th:replace="~{fragments :: navbar}"></div>

<div class="container mt-5">
    <div class="card shadow border-0">
        <div class="card-header bg-primary text-white">
            <h4 class="mb-0">Detalle de la Visita</h4>
        </div>

        <div class="card-body">
            <p><strong>Cliente:</strong> <span th:text="${visita.customerName}"></span></p>
            <p><strong>Fecha programada:</strong> <span th:text="${#temporals.format(visita.scheduledStartAt, 'dd/MM/yyyy HH:mm')}"></span></p>

            <form th:action="@{'/visits/' + ${visita.id} + '/update'}" method="post">
                <!-- Estado -->
                <div class="mb-3">
                    <label class="form-label"><strong>Estado:</strong></label>
                    <select class="form-select" name="estado" th:disabled="${esTecnico}">
                        <option value="PLANNED" th:selected="${visita.state == 'PLANNED'}">Planificada</option>
                        <option value="STARTED" th:selected="${visita.state == 'STARTED'}">En progreso</option>
                        <option value="DONE" th:selected="${visita.state == 'DONE'}">Finalizada</option>
                    </select>
                </div>

                <!-- T√©cnico -->
                <p><strong>T√©cnico:</strong> <span th:text="${visita.technicianName}"></span></p>

                <!-- Prop√≥sito (botones) -->
                <div class="mb-3">
                    <label class="form-label"><strong>Prop√≥sito:</strong></label>
                    <div class="btn-group d-flex flex-wrap gap-2" th:if="${!esTecnico}">
                        <button type="button" class="btn btn-outline-info" onclick="setPurpose('INSTALACION')">Instalaci√≥n</button>
                        <button type="button" class="btn btn-outline-warning" onclick="setPurpose('MANTENIMIENTO')">Mantenimiento</button>
                        <button type="button" class="btn btn-outline-success" onclick="setPurpose('REVISION')">Revisi√≥n</button>
                        <button type="button" class="btn btn-outline-secondary" onclick="setPurpose('OTRO')">Otro</button>
                    </div>
                    <div th:if="${esTecnico}" class="form-control-plaintext" th:text="${visita.purpose}">-</div>
                    <input type="hidden" name="proposito" id="proposito" th:value="${visita.purpose}">
                    <div class="mt-2 text-muted small">Seleccionado: <span id="purposeDisplay" th:text="${visita.purpose}">-</span></div>
                </div>

                <!-- Notas -->
                <div class="mb-3">
                    <label class="form-label"><strong>Notas:</strong></label>
                    <textarea class="form-control" name="notas" rows="3" th:text="${visita.notesPlanned}" th:readonly="${esTecnico}"></textarea>
                </div>

                <!-- Botones -->
                <div class="d-flex justify-content-between mt-4">
                    <a href="/visitas" class="btn btn-outline-secondary">‚Üê Regresar</a>
                    <button type="submit" class="btn btn-success" th:disabled="${esTecnico}">üíæ Guardar Cambios</button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
    function setPurpose(value) {
        document.getElementById('proposito').value = value;
        document.getElementById('purposeDisplay').innerText = value;
    }
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
