<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="es">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Clientes</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body>

  <!-- ✅ Inserta el navbar desde fragments -->
  <div th:replace="~{fragments :: navbar}"></div>

  <div class="container py-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
      <h1 class="mb-0">Clientes</h1>
      <span th:if="${customerForm.id != null}" class="badge bg-info text-dark">Editando</span>
    </div>

    <div th:if="${success}" class="alert alert-success" role="alert" th:text="${success}"></div>
    <div th:if="${error}" class="alert alert-danger" role="alert" th:text="${error}"></div>

    <div class="row g-4">
      <div class="col-lg-4">
        <div class="card shadow-sm h-100">
          <div class="card-header bg-dark text-white">
            <span th:text="${customerForm.id != null} ? 'Editar cliente' : 'Nuevo cliente'">Nuevo cliente</span>
          </div>
          <div class="card-body">
            <form th:action="@{/clientes}" th:object="${customerForm}" method="post" class="needs-validation">
              <input type="hidden" th:field="*{id}" />
              <div class="mb-3">
                <label for="name" class="form-label">Nombre</label>
                <input type="text" id="name" th:field="*{name}" class="form-control" placeholder="Ej. SkyNet Corp" />
                <div th:if="${#fields.hasErrors('name')}" th:errors="*{name}" class="text-danger small"></div>
              </div>
              <div class="mb-3">
                <label for="taxId" class="form-label">RFC / Identificador Fiscal</label>
                <input type="text" id="taxId" th:field="*{taxId}" class="form-control" placeholder="Opcional" />
                <div th:if="${#fields.hasErrors('taxId')}" th:errors="*{taxId}" class="text-danger small"></div>
              </div>
              <div class="mb-3">
                <label for="email" class="form-label">Email</label>
                <input type="email" id="email" th:field="*{email}" class="form-control" placeholder="contacto@cliente.com" />
                <div th:if="${#fields.hasErrors('email')}" th:errors="*{email}" class="text-danger small"></div>
              </div>
              <div class="mb-3">
                <label for="phone" class="form-label">Teléfono</label>
                <input type="text" id="phone" th:field="*{phone}" class="form-control" placeholder="Opcional" />
                <div th:if="${#fields.hasErrors('phone')}" th:errors="*{phone}" class="text-danger small"></div>
              </div>
              <div class="mb-3">
                <label for="address" class="form-label">Dirección</label>
                <textarea id="address" th:field="*{address}" class="form-control" rows="3" placeholder="Calle, número y ciudad"></textarea>
                <div th:if="${#fields.hasErrors('address')}" th:errors="*{address}" class="text-danger small"></div>
              </div>
              <div class="d-flex gap-2">
                <button type="submit" class="btn btn-primary w-100"
                        th:text="${customerForm.id != null} ? 'Actualizar' : 'Crear'">Crear</button>
                <a th:if="${customerForm.id != null}" class="btn btn-outline-secondary w-100" th:href="@{/clientes}">Cancelar</a>
              </div>
            </form>
          </div>
        </div>
      </div>

      <div class="col-lg-8">
        <div class="card shadow-sm">
          <div class="card-header bg-light">
            <h2 class="h5 mb-0">Listado de Clientes</h2>
          </div>
          <div class="card-body p-0">
            <div class="table-responsive">
              <table class="table table-striped table-hover align-middle mb-0">
                <thead class="table-dark">
                  <tr>
                    <th>Nombre</th>
                    <th>RFC</th>
                    <th>Email</th>
                    <th>Teléfono</th>
                    <th>Dirección</th>
                    <th class="text-center" style="width: 140px;">Acciones</th>
                  </tr>
                </thead>
                <tbody>
                  <tr th:each="c : ${clientes}" th:if="${c != null}">
                    <td th:text="${c.name}">Nombre</td>
                    <td th:text="${c.taxId}">RFC</td>
                    <td th:text="${c.email}">Email</td>
                    <td th:text="${c.phone}">Teléfono</td>
                    <td th:text="${c.address}">Dirección</td>
                    <td class="text-center">
                      <div class="btn-group btn-group-sm">
                        <a th:href="@{/clientes/edit/{id}(id=${c.id})}" class="btn btn-outline-secondary">Editar</a>
                        <form th:action="@{/clientes/delete/{id}(id=${c.id})}" method="post"
                              onsubmit="return confirm('¿Eliminar este cliente?');">
                          <button type="submit" class="btn btn-outline-danger">Eliminar</button>
                        </form>
                      </div>
                    </td>
                  </tr>
                  <tr th:if="${#lists.isEmpty(clientes)}">
                    <td colspan="6" class="text-center text-muted py-4">No hay clientes registrados.</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>
